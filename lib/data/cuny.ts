import { sql, isDbConfigured } from "@/lib/db";

export type Campus = {
  type: string;
  campus: string;
  website: string | null;
  address: string | null;
  city: string | null;
  state: string | null;
  zip: string | null;
  latitude: number | null;
  longitude: number | null;
};

export async function getCampuses(): Promise<Campus[]> {
  if (!isDbConfigured) {
    // Return sample data when database is not available
    return [
      {
        type: "Community Colleges",
        campus: "Borough of Manhattan Community College",
        website: "https://www.bmcc.cuny.edu/",
        address: "199 Chambers Street",
        city: "New York",
        state: "NY",
        zip: "10007-1044",
        latitude: 40.717367,
        longitude: -74.012178,
      },
      {
        type: "Community Colleges",
        campus: "Bronx Community College",
        website: "https://www.bcc.cuny.edu/",
        address: "2155 University Avenue",
        city: "Bronx",
        state: "NY",
        zip: "10453-2804",
        latitude: 40.856673,
        longitude: -73.910127,
      },
      {
        type: "Community Colleges",
        campus: "Hostos Community College",
        website: "http://hostos.cuny.edu",
        address: "500 Grand Concourse",
        city: "Bronx",
        state: "NY",
        zip: "10451-5323",
        latitude: 40.817828,
        longitude: -73.926862,
      },
      {
        type: "Community Colleges",
        campus: "Kingsborough Community College",
        website: "http://kbcc.cuny.edu",
        address: "2001 Oriental Boulevard",
        city: "Brooklyn",
        state: "NY",
        zip: "11235-2333",
        latitude: 40.578349,
        longitude: -73.934465,
      },
      {
        type: "Community Colleges",
        campus: "LaGuardia Community College",
        website: "https://www.laguardia.edu/",
        address: "31-10 Thomson Avenue",
        city: "Long Island City",
        state: "NY",
        zip: "11101-3007",
        latitude: 40.743951,
        longitude: -73.935154,
      },
      {
        type: "Community Colleges",
        campus: "Queensborough Community College",
        website: "https://www.qcc.cuny.edu/",
        address: "222-05 56th Avenue",
        city: "Bayside",
        state: "NY",
        zip: "11364-1497",
        latitude: 40.75615,
        longitude: -73.75755,
      },
      {
        type: "Community Colleges",
        campus: "Guttman Community College",
        website: "https://guttman.cuny.edu/",
        address: "50 West 40th Street",
        city: "New York",
        state: "NY",
        zip: "10018-2602",
        latitude: 40.752846,
        longitude: -73.984133,
      },
      {
        type: "Comprehensive Colleges",
        campus: "Medgar Evers College",
        website: "http://mec.cuny.edu",
        address: "1650 Bedford Avenue",
        city: "Brooklyn",
        state: "NY",
        zip: "11225-2010",
        latitude: 40.66624,
        longitude: -73.957349,
      },
      {
        type: "Comprehensive Colleges",
        campus: "New York City College of Technology",
        website: "https://www.citytech.cuny.edu/",
        address: "300 Jay Street",
        city: "Brooklyn",
        state: "NY",
        zip: "11201-1909",
        latitude: 40.695507,
        longitude: -73.987882,
      },
      {
        type: "Comprehensive Colleges",
        campus: "College of Staten Island",
        website: "http://csi.cuny.edu",
        address: "2800 Victory Boulevard",
        city: "Staten Island",
        state: "NY",
        zip: "10314-6609",
        latitude: 40.608648,
        longitude: -74.153563,
      },
      {
        type: "Graduate Colleges",
        campus: "School of Labor and Urban Studies",
        website: "https://slu.cuny.edu/",
        address: "25 West 43rd Street, 19th Floor",
        city: "New York",
        state: "NY",
        zip: "10036-7410",
        latitude: 40.75541,
        longitude: -73.98184,
      },
      {
        type: "Graduate Colleges",
        campus: "School of Law",
        website: "http://law.cuny.edu",
        address: "2 Court Square",
        city: "Long Island City",
        state: "NY",
        zip: "11101-4356",
        latitude: 40.747639,
        longitude: -73.943676,
      },
      {
        type: "Graduate Colleges",
        campus: "The Graduate School and University Center",
        website: "http://gc.cuny.edu",
        address: "365 5th Avenue",
        city: "New York",
        state: "NY",
        zip: "10016-4309",
        latitude: 40.748724,
        longitude: -73.984205,
      },
      {
        type: "Graduate Colleges",
        campus: "School of Professional Studies",
        website: "https://sps.cuny.edu/",
        address: "119 West 31st Street",
        city: "New York",
        state: "NY",
        zip: "10001-3400",
        latitude: 40.748151,
        longitude: -73.989723,
      },
      {
        type: "Graduate Colleges",
        campus: "School of Public Health",
        website: "http://sph.cuny.edu/",
        address: "55 W 125th Street",
        city: "New York",
        state: "NY",
        zip: "10027-4516",
        latitude: 40.80771,
        longitude: -73.9442,
      },
      {
        type: "Graduate Colleges",
        campus: "School of Journalism",
        website: "http://journalism.cuny.edu",
        address: "219 West 40th Street",
        city: "New York",
        state: "NY",
        zip: "10018-1507",
        latitude: 40.755343,
        longitude: -73.988846,
      },
      {
        type: "Honors Colleges",
        campus: "Macaulay Honors College",
        website: "https://macaulay.cuny.edu/",
        address: "35 West 67th Street",
        city: "New York",
        state: "NY",
        zip: "10023-6203",
        latitude: 40.77384,
        longitude: -73.9802,
      },
      {
        type: "Senior Colleges",
        campus: "Baruch College",
        website: "http://baruch.cuny.edu",
        address: "55 Lexington Ave at 24th Street",
        city: "New York",
        state: "NY",
        zip: "10010-2313",
        latitude: 40.740977,
        longitude: -73.984252,
      },
      {
        type: "Senior Colleges",
        campus: "Brooklyn College",
        website: "http://brooklyn.cuny.edu",
        address: "2900 Bedford Avenue",
        city: "Brooklyn",
        state: "NY",
        zip: "11210-2850",
        latitude: 40.630276,
        longitude: -73.955545,
      },
      {
        type: "Senior Colleges",
        campus: "The City College of New York",
        website: "http://ccny.cuny.edu",
        address: "160 Convent Avenue",
        city: "New York",
        state: "NY",
        zip: "10031-9101",
        latitude: 40.819548,
        longitude: -73.949518,
      },
      {
        type: "Senior Colleges",
        campus: "School of Medicine",
        website: "http://www.ccny.cuny.edu/csom",
        address: "160 Convent Avenue",
        city: "New York",
        state: "NY",
        zip: "10031-9101",
        latitude: 40.819548,
        longitude: -73.949518,
      },
      {
        type: "Senior Colleges",
        campus: "Hunter College",
        website: "http://hunter.cuny.edu",
        address: "695 Park Avenue",
        city: "New York",
        state: "NY",
        zip: "10065-5024",
        latitude: 40.768731,
        longitude: -73.964915,
      },
      {
        type: "Senior Colleges",
        campus: "John Jay College of Criminal Justice",
        website: "http://jjay.cuny.edu",
        address: "524 West 59th Street",
        city: "New York",
        state: "NY",
        zip: "10019-1104",
        latitude: 40.769939,
        longitude: -73.986469,
      },
      {
        type: "Senior Colleges",
        campus: "Lehman College",
        website: "https://www.lehman.cuny.edu/",
        address: "250 Bedford Park Boulevard West",
        city: "Bronx",
        state: "NY",
        zip: "10468-1527",
        latitude: 40.873442,
        longitude: -73.889361,
      },
      {
        type: "Senior Colleges",
        campus: "Queens College",
        website: "http://qc.cuny.edu",
        address: "65-30 Kissena Blvd",
        city: "Flushing",
        state: "NY",
        zip: "11367-1597",
        latitude: 40.736316,
        longitude: -73.820035,
      },
      {
        type: "Senior Colleges",
        campus: "York College",
        website: "http://york.cuny.edu",
        address: "94-20 Guy R. Brewer Boulevard",
        city: "Jamaica",
        state: "NY",
        zip: "11451-0001",
        latitude: 40.702821,
        longitude: -73.795776,
      },
    ];
  }

  const rows = await sql`
    select
      institution_type,
      campus,
      campus_website,
      address,
      city,
      state,
      zip,
      latitude,
      longitude
    from cuny_campus_locations
    order by campus
  `;

  return (rows as Array<{ [key: string]: any }>).map((row) => ({
    type: row.institution_type,
    campus: row.campus,
    website: row.campus_website,
    address: row.address,
    city: row.city,
    state: row.state,
    zip: row.zip,
    latitude: row.latitude !== null ? Number(row.latitude) : null,
    longitude: row.longitude !== null ? Number(row.longitude) : null,
  }));
}
